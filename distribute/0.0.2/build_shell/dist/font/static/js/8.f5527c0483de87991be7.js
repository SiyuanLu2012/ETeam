webpackJsonp([8],{"3Wmt":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("Dd8w"),s=i.n(o),n=(i("IcnI"),i("NYxO")),a=i("Gu7T"),r=i.n(a),c=i("HA7x"),l=i("mM4c"),d={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("Card",{staticClass:"citask-card",attrs:{bordered:!1}},[i("div",{staticClass:"citask-card-title"},[t.item.IsActive?i("a",{staticStyle:{color:"inherit","text-decoration":"underline"},attrs:{target:"_self",href:t.item.TaskHistoryURI}},[t._v("\n      #"+t._s(t.item.BuildVersion)+" "+t._s(t.item.TaskName)+"\n    ")]):t._e(),t._v(" "),!1===t.item.IsActive?i("a",{staticStyle:{color:"inherit","text-decoration":"underline"},attrs:{href:"#"}},[t._v("\n      #"+t._s(t.item.BuildVersion)+" "+t._s(t.item.TaskName)+"\n    ")]):t._e(),t._v(" "),i("span",{staticClass:"pull-right",staticStyle:{"margin-right":"10px"}},[!1===t.item.IsActive?i("span",[i("Tooltip",{attrs:{content:"记录已清除"}},[i("Icon",{attrs:{type:"ios-information-circle-outline"}})],1)],1):t._e()])]),t._v(" "),i("div",{staticClass:"citask-card-body"},[i("span",{staticStyle:{width:"220px",display:"inline-block","text-align":"left"}},[i("span",{staticStyle:{"margin-top":"25px","margin-left":"0px"}},[1===t.item.BuildStatus?i("Icon",{staticStyle:{color:"#388e83"},attrs:{type:"ios-checkmark-circle"}}):t._e(),t._v(" "),2===t.item.BuildStatus?i("Icon",{staticStyle:{color:"darkred"},attrs:{type:"ios-close-circle"}}):t._e(),t._v(" "),3===t.item.BuildStatus?i("Icon",{staticStyle:{color:"olive"},attrs:{type:"ios-remove-circle"}}):t._e(),t._v(" "),0===t.item.BuildStatus?i("Icon",{staticStyle:{color:"cornflowerblue"},attrs:{type:"ios-remove-circle"}}):t._e(),t._v("\n          "+t._s(t.item.StartTimeFormatString)+" ")],1)]),t._v(" "),i("span",{staticStyle:{width:"80px","margin-top":"25px",display:"inline-block"}},[0!==t.item.BuildStatus&&""!==t.item.BuildLog?i("a",{staticStyle:{color:"inherit","text-decoration":"underline"},attrs:{href:t.item.BuildLog,target:"_blank"}},[t._v("日志")]):t._e()])])])],1)},staticRenderFns:[]};var u=i("VU/8")({name:"ciTaskHistoryItem",props:["item"],data:function(){return{msg:""}},methods:{onDPItemClick:function(t){var e=this,i=t.split(",");this.$axios.get("/api/ci/task_basic/"+i[1]+"/start/?BuildParameter="+i[0]).then(function(t){e.$Message.success({content:t.data.result.message,duration:10})},function(t){e.$Message.error({content:t.data.result.message,duration:10})})},onBuildClick:function(t){var e=this;this.$axios.get("/api/ci/task_basic/"+t+"/start/").then(function(t){e.$Message.success({content:t.data.result.message,duration:10})},function(t){e.$Message.error({content:t.data.result.message,duration:10})})}}},d,!1,function(t){i("R+Ql")},"data-v-4ef77035",null).exports,h=i("P7xe"),p={name:"flowHistoryItem",props:["flowID"],data:function(){return{taskFlowHistories:{},currentSection:0}},computed:s()({},Object(n.c)("citaskflow",["addedSection","ciTaskAddedToSection","sectionRenamed"]),Object(n.c)(["appBodyHeight"]),{historyContainerHeight:function(){return this.appBodyHeight-38},taskFlowID:function(){return this.flowID+""=="undefined"?0:this.flowID},sectionID:function(){return this.currentSection}}),methods:s()({},Object(n.d)("citaskflow",["setAddedSection","setAddedSectionDialogShow","setSectionRenamed","setRenameSectionDialogShow","setCITaskAddedToSectionDialogShow","setCITaskAddedToSection"]),{loadFlowHistory:function(t){var e=this;t+""!="0"&&this.$axios.get("/api/ci/task_flow/"+this.flowID+"/history/list?page_size=17").then(function(t){e.taskFlowHistories=t.data.result},function(t){})},editSection:function(t){this.currentSection=t,this.setCITaskAddedToSectionDialogShow(!0)},handleReachBottom:function(){var t=this;null!==this.taskFlowHistories.next&&this.$axios.get(this.taskFlowHistories.next).then(function(e){var i;(i=t.taskFlowHistories.results).push.apply(i,r()(e.data.result.results)),t.taskFlowHistories.next=e.data.result.next},function(t){})},onEnd:function(t){var e=this,i=t.to.getAttribute("id"),o=t.from.getAttribute("id"),s=t.oldIndex,n=t.newIndex,a=t.item.getAttribute("id");this.alterColumnData(o,i,a,s,n),this.$axios.patch("/api/project/task/"+a+"/",{Status:i}).then(function(t){console.log(t)},function(t){e.setTaskChange(!0)})},flowContextMenuClick:function(t){var e=this,i=t.split(":"),o=i[0],s=i[1];if(this.currentSection=s,"rename"===o&&this.setRenameSectionDialogShow(!0),"start"===o&&this.startSection(s),"delete"===o){var n=this.findSection(s).SectionName;this.$Modal.confirm({title:"删除确认",content:"<p>删除是危险操作，确认要删除任务阶段 ["+n+" ] 吗？</p>",onOk:function(){e.deleteFlowSection(s)},onCancel:function(){}})}},deleteFlowSection:function(t){var e=this;this.$axios.delete("/api/ci/task_flow/section/"+t).then(function(t){e.loadFlowTasks(e.taskFlowID)},function(t){})},startSection:function(t){var e=this;this.$axios.get("/api/ci/flow_section/"+t+"/start/").then(function(t){e.$Message.success({content:t.data.result.message,duration:10})},function(t){})},findSection:function(t){for(var e=null,i=0;i<this.taskFlow.Sections.length;i++)if(this.taskFlow.Sections[i].id+""===t){e=this.taskFlow.Sections[i];break}return e},changeHistory:function(t){console.log(t)}}),created:function(){this.loadFlowHistory(this.taskFlowID)},watch:{taskFlowID:function(){this.loadFlowHistory(this.taskFlowID)}},components:{SectionCreateDialog:c.a,ciTaskHistoryItem:u,FlowSection:h.a,TaskAddToSectionDialog:l.a}},f={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Scroll",{attrs:{"on-reach-bottom":t.handleReachBottom,height:t.historyContainerHeight}},[i("Collapse",{attrs:{simple:"",accordion:""},on:{"on-change":t.changeHistory}},t._l(t.taskFlowHistories.results,function(e){return i("Panel",{key:e.id,staticStyle:{"padding-bottom":"12px"},attrs:{name:""+e.id,v:""}},[i("span",{staticStyle:{"padding-right":"5px"}},[i("Tooltip",{attrs:{content:"执行中"}},[0===e.Status?i("Icon",{staticStyle:{color:"#337ab7"},attrs:{type:"ios-remove-circle"}}):t._e()],1),t._v(" "),i("Tooltip",{attrs:{content:"成功"}},[1===e.Status?i("Icon",{staticStyle:{color:"#388e83"},attrs:{type:"ios-checkmark-circle"}}):t._e()],1),t._v(" "),i("Tooltip",{attrs:{content:"失败"}},[2===e.Status?i("Icon",{staticStyle:{color:"darkred"},attrs:{type:"ios-close-circle"}}):t._e()],1)],1),t._v(" "),i("span",{staticStyle:{"padding-right":"20px"}},[t._v("#"+t._s(e.id))]),t._v(" "),i("span",{staticStyle:{"padding-right":"20px","min-width":"200px",display:"inline-block"}},[t._v(t._s(e.StartTimeFormat)+"\n        ")]),t._v(" "),i("span",{staticStyle:{"padding-right":"20px"}},[i("Avatar",{staticStyle:{"background-color":"#388e83"},attrs:{size:"small"}},[t._v(t._s(e.StartedUser))])],1),t._v(" "),0!==e.Status?i("div",{attrs:{slot:"content"},slot:"content"},[i("div",{style:"height:"+t.historyContainerHeight-78+"px; overflow-y:scroll;padding-right:10px;"},t._l(e.SectionHistories,function(e){return i("flow-section",{key:e.id,staticStyle:{"margin-left":"10px"},attrs:{columnID:e.id,group:"flowHistory",itemList:e.TaskHistories,columnTitle:e.SectionName,dishover:!1,shadow:!1,bordered:!0},on:{"update:itemList":function(i){t.$set(e,"TaskHistories",i)},end:t.onEnd},scopedSlots:t._u([{key:"default",fn:function(t){return[i("ci-task-history-item",{attrs:{item:t.element}})]}}])},[i("Card",{staticClass:"board-column-title",attrs:{slot:"column-header",bordered:!1,shadow:!1,"dis-hover":!0},slot:"column-header"},[i("span",[i("Avatar",{staticStyle:{border:"1px solid black","background-color":"#f5f7f9",color:"#5f5f5f","margin-right":"0px"},attrs:{size:"small"}},[t._v(t._s(e.SectionIndex))]),t._v(" "),i("span",{staticStyle:{"font-size":"16px"}},[t._v(t._s(e.SectionName))]),t._v(" "),i("Tooltip",{attrs:{content:"执行中"}},[0===e.Status?i("Icon",{staticStyle:{color:"#337ab7"},attrs:{type:"ios-remove-circle"}}):t._e()],1),t._v(" "),i("Tooltip",{attrs:{content:"成功"}},[1===e.Status?i("Icon",{staticStyle:{color:"#388e83"},attrs:{type:"ios-checkmark-circle"}}):t._e()],1),t._v(" "),i("Tooltip",{attrs:{content:"失败"}},[2===e.Status?i("Icon",{staticStyle:{color:"darkred"},attrs:{type:"ios-close-circle"}}):t._e()],1)],1)])],1)}))]):t._e()])}))],1)},staticRenderFns:[]};var m=i("VU/8")(p,f,!1,function(t){i("qb0S")},"data-v-fb9ac6ac",null).exports,S={name:"flowHistory",props:["flowID"],data:function(){return{msg:"Welcome to Your Vue.js App"}},computed:s()({},Object(n.c)(["appBodyHeight"]),{historyContainerHeight:function(){return this.appBodyHeight-33}}),components:{flowHistoryItem:m}},g={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{style:"height:"+this.historyContainerHeight+"px; overflow-y:scroll;padding-left:10px;padding-right:10px;"},[e("flow-history-item",{attrs:{flowID:this.flowID}})],1)},staticRenderFns:[]};var y=i("VU/8")(S,g,!1,function(t){i("Zw6G")},"data-v-d86c849c",null);e.default=y.exports},"R+Ql":function(t,e){},Zw6G:function(t,e){},qb0S:function(t,e){}});
//# sourceMappingURL=8.f5527c0483de87991be7.js.map